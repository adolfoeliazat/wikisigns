var letters = new Array(4);

letters[0] = new Array(4);
letters[0][0] = new Array(12);
letters[0][0][0] = 'z';
letters[0][0][1] = '28';
letters[0][0][2] = '48';
letters[0][0][3] = '58';
letters[0][0][4] = '68';
letters[0][0][5] = '78';
letters[0][0][6] = '80';
letters[0][0][7] = '81';
letters[0][0][8] = '82';
letters[0][0][9] = '83';
letters[0][0][10] = '87';
letters[0][0][11] = '88';
letters[0][0][12] = '98';
letters[0][1] = new Array(11);
letters[0][1][0] = 't';
letters[0][1][1] = '@';
letters[0][1][2] = '12';
letters[0][1][3] = '21';
letters[0][1][4] = '22';
letters[0][1][5] = '25';
letters[0][1][6] = '26';
letters[0][1][7] = '27';
letters[0][1][8] = '28';
letters[0][1][9] = '32';
letters[0][1][10] = '42';
letters[0][1][11] = '92';
letters[0][2] = new Array(7);
letters[0][2][0] = 'j';
letters[0][2][1] = '11';
letters[0][2][2] = '12';
letters[0][2][3] = '31';
letters[0][2][4] = '51';
letters[0][2][5] = '61';
letters[0][2][6] = '71';
letters[0][2][7] = '91';
letters[0][3] = new Array(15);
letters[0][3][0] = 'f';
letters[0][3][1] = '07';
letters[0][3][2] = '17';
letters[0][3][3] = '27';
letters[0][3][4] = '37';
letters[0][3][5] = '57';
letters[0][3][6] = '67';
letters[0][3][7] = '70';
letters[0][3][8] = '71';
letters[0][3][9] = '72';
letters[0][3][10] = '73';
letters[0][3][11] = '74';
letters[0][3][12] = '75';
letters[0][3][13] = '77';
letters[0][3][14] = '78';
letters[0][3][15] = '79';

letters[1] = new Array(4);
letters[1][0] = new Array(8);
letters[1][0][0] = 'c';
letters[1][0][1] = '08';
letters[1][0][2] = '18';
letters[1][0][3] = '38';
letters[1][0][4] = '84';
letters[1][0][5] = '85';
letters[1][0][6] = '86';
letters[1][0][7] = '88';
letters[1][0][8] = '89';
letters[1][1] = new Array(10);
letters[1][1][0] = 'h';
letters[1][1][1] = '15';
letters[1][1][2] = '25';
letters[1][1][3] = '35';
letters[1][1][4] = '45';
letters[1][1][5] = '52';
letters[1][1][6] = '55';
letters[1][1][7] = '57';
letters[1][1][8] = '58';
letters[1][1][9] = '65';
letters[1][1][10] = '95';
letters[1][2] = new Array(14);
letters[1][2][0] = 'i';
letters[1][2][1] = 'y';
letters[1][2][2] = '01';
letters[1][2][3] = '10';
letters[1][2][4] = '11';
letters[1][2][5] = '13';
letters[1][2][6] = '14';
letters[1][2][7] = '15';
letters[1][2][8] = '16';
letters[1][2][9] = '17';
letters[1][2][10] = '18';
letters[1][2][11] = '19';
letters[1][2][12] = '21';
letters[1][2][13] = '41';
letters[1][2][14] = '81';
letters[1][3] = new Array(7);
letters[1][3][0] = 'pinto*';
letters[1][3][1] = '14';
letters[1][3][2] = '44';
letters[1][3][3] = '54';
letters[1][3][4] = '64';
letters[1][3][5] = '74';
letters[1][3][6] = '84';
letters[1][3][7] = '94';

letters[2] = new Array(4);
letters[2][0] = new Array(10);
letters[2][0][0] = 'penta*';
letters[2][0][1] = '05';
letters[2][0][2] = '50';
letters[2][0][3] = '51';
letters[2][0][4] = '53';
letters[2][0][5] = '54';
letters[2][0][6] = '55';
letters[2][0][7] = '56';
letters[2][0][8] = '59';
letters[2][0][9] = '75';
letters[2][0][10] = '85';
letters[2][1] = new Array(20);
letters[2][1][0] = 'd';
letters[2][1][1] = 'm';
letters[2][1][2] = '03';
letters[2][1][3] = '13';
letters[2][1][4] = '23';
letters[2][1][5] = '30';
letters[2][1][6] = '31';
letters[2][1][7] = '32';
letters[2][1][8] = '33';
letters[2][1][9] = '34';
letters[2][1][10] = '35';
letters[2][1][11] = '36';
letters[2][1][12] = '37';
letters[2][1][13] = '38';
letters[2][1][14] = '39';
letters[2][1][15] = '43';
letters[2][1][16] = '53';
letters[2][1][17] = '63';
letters[2][1][18] = '73';
letters[2][1][19] = '83';
letters[2][1][20] = '93';
letters[2][2] = new Array(17);
letters[2][2][0] = 'k';
letters[2][2][1] = 's';
letters[2][2][2] = 'v';
letters[2][2][3] = 'l';
letters[2][2][4] = 'r';
letters[2][2][5] = '04';
letters[2][2][6] = '24';
letters[2][2][7] = '34';
letters[2][2][8] = '40';
letters[2][2][9] = '41';
letters[2][2][10] = '42';
letters[2][2][11] = '43';
letters[2][2][12] = '44';
letters[2][2][13] = '45';
letters[2][2][14] = '46';
letters[2][2][15] = '47';
letters[2][2][16] = '48';
letters[2][2][17] = '49';
letters[2][3] = new Array(20);
letters[2][3][0] = 'b';
letters[2][3][1] = 'n';
letters[2][3][2] = '06';
letters[2][3][3] = '16';
letters[2][3][4] = '26';
letters[2][3][5] = '36';
letters[2][3][6] = '46';
letters[2][3][7] = '56';
letters[2][3][8] = '60';
letters[2][3][9] = '61';
letters[2][3][10] = '62';
letters[2][3][11] = '63';
letters[2][3][12] = '64';
letters[2][3][13] = '65';
letters[2][3][14] = '66';
letters[2][3][15] = '67';
letters[2][3][16] = '68';
letters[2][3][17] = '69';
letters[2][3][18] = '76';
letters[2][3][19] = '86';
letters[2][3][20] = '96';

letters[3] = new Array(4);
letters[3][0] = new Array(24);
letters[3][0][0] = 'e';
letters[3][0][1] = 'w';
letters[3][0][2] = 'x';
letters[3][0][3] = 'ä';
letters[3][0][4] = 'ü';
letters[3][0][5] = 'ö';
letters[3][0][6] = '00';
letters[3][0][7] = '01';
letters[3][0][8] = '02';
letters[3][0][9] = '03';
letters[3][0][10] = '04';
letters[3][0][11] = '05';
letters[3][0][12] = '06';
letters[3][0][13] = '07';
letters[3][0][14] = '08';
letters[3][0][15] = '09';
letters[3][0][16] = '10';
letters[3][0][17] = '20';
letters[3][0][18] = '30';
letters[3][0][19] = '40';
letters[3][0][20] = '50';
letters[3][0][21] = '60';
letters[3][0][22] = '70';
letters[3][0][23] = '80';
letters[3][0][24] = '90';
letters[3][1] = new Array(12);
letters[3][1][0] = 'a';
letters[3][1][1] = 'ä';
letters[3][1][2] = '@';
letters[3][1][3] = '02';
letters[3][1][4] = '20';
letters[3][1][5] = '22';
letters[3][1][6] = '23';
letters[3][1][7] = '24';
letters[3][1][8] = '29';
letters[3][1][9] = '52';
letters[3][1][10] = '62';
letters[3][1][11] = '72';
letters[3][1][12] = '82';
letters[3][2] = new Array(22);
letters[3][2][0] = 'o';
letters[3][2][1] = 'g';
letters[3][2][2] = 'q';
letters[3][2][3] = 'ö';
letters[3][2][4] = '09';
letters[3][2][5] = '19';
letters[3][2][6] = '29';
letters[3][2][7] = '39';
letters[3][2][8] = '49';
letters[3][2][9] = '59';
letters[3][2][10] = '69';
letters[3][2][11] = '79';
letters[3][2][12] = '89';
letters[3][2][13] = '90';
letters[3][2][14] = '91';
letters[3][2][15] = '92';
letters[3][2][16] = '93';
letters[3][2][17] = '94';
letters[3][2][18] = '95';
letters[3][2][19] = '96';
letters[3][2][20] = '97';
letters[3][2][21] = '98';
letters[3][2][22] = '99';
letters[3][3] = new Array(6);
letters[3][3][0] = 'u';
letters[3][3][1] = 'ü';
letters[3][3][2] = '47';
letters[3][3][3] = '76';
letters[3][3][4] = '77';
letters[3][3][5] = '87';
letters[3][3][6] = '97';

// Definition of the colors
var colors = Array(
 '#FF8F35', // 0: orange
 '#777F7E', // 1
 '#1f51a8', // 2
 '#e6437f', // 3
 '#5F2A17', // 4
 '#49c8fa', // 5
 '#DFBE29', // 6
 '#09ee6a', // 7
 '#b392d8', // 8
 '#FFF82A' // 9
);


// Draws a word as an image.
function drawWordAsImage(element, input_word, size) {
  var big_size = 424;
  if(size == null) size = big_size;
  var scale = size / big_size;
  var circle_dimension = 95;
  var margin = 8;
  var space = 7;
  var canvas_width = size;
  var canvas_height = size;
  if(scale < 1){
    canvas_height += 4;
    canvas_width += 4;
  }
  var word = input_word.toLowerCase();
  var paper_space = 7;
  var paper = Raphael(element, canvas_width, canvas_height);
  var corner_radius = 10 * scale;

  // Drop shadow for carpet
  var paper_shadow = paper.rect(2, 2, canvas_width - paper_space, canvas_width - paper_space, corner_radius);
  paper_shadow.attr({stroke: "none", fill: "#555", translation: "2,2"});
  paper_shadow.blur(2);

  // The carpet itself
  var paper_content = paper.rect(2, 2, canvas_width - paper_space, canvas_width - paper_space, corner_radius);
  paper_content.attr({stroke: "none", fill: "#efefef"});

  // Paint all 4x4 blocks
  for(var y = 0; y < 4; y++){
    for(var x = 0; x < 4; x++){
      var point_x, point_y;
      var space_x = x * circle_dimension + space * x;
      var space_y = y * circle_dimension + space * y;
      var block_color = blockColor(word, letters[y][x], coord2color(y, x));
      var point_color = pointColor(block_color);
      var point_width = pointWidth(block_color);
      var shadow;
      var block;
      var offset_y = 0;
      var offset_x = 0;

      if(scale != 1){
        point_width = 1;
      }
      if(scale < 1){
        offset_y = 1.5;
        offset_x = 1.5;
      }
      // Inner Circle
      point_x = margin + circle_dimension/2 + space_x;
      point_y = margin + circle_dimension/2 + space_y;
      var point = paper.circle(offset_x + (point_x * scale), offset_y + (point_y * scale), 5);
      point.attr({fill: 'none', stroke: point_color, 'stroke-width': point_width});
      point.toBack();
      point.scale(scale, scale);

      if (block_color != 'none') {
        // Block
        block = paper.rect(offset_x + ((margin + space_x) * scale), offset_y + ((margin + space_y) * scale), circle_dimension * scale, circle_dimension * scale, corner_radius);
        block.attr({fill: block_color, stroke: 'none'});
        block.toBack();

        // Drop shadow
        shadow = paper.rect((margin + space_x) * scale, offset_y + ((margin + space_y) * scale), circle_dimension * scale, circle_dimension * scale, corner_radius);
        shadow.attr({stroke: "none", fill: "gray", translation: "2,2"});
        shadow.blur(2);
        shadow.toBack();
      }
    }
  }

  // paint the word lines.
  var coordinates = getCoordinatesFromWord(word);
  var path_x, path_y;

  /*for(var i = 0;i < coordinates.length; i++){
    // Inner Circle
    point_x = margin + circle_dimension/2 + space_x;
    point_y = margin + circle_dimension/2 + space_y;

    if(path_x != undefined && path_y != undefined){
      var path = paper.path("M"+path_x+" "+path_y+"L"+point_x+" "+point_y);

      path.attr({stroke: point_color, 'stroke-width': 10, 'stroke-linecap': 'round', opacity: 0.75});
      path.toFront();
    }

    // Save coords for path
    path_x = point_x;
    path_y = point_y;
  }*/

  // Paint P
  if(hasALetterP(word)){
    var letter_p = paper.circle(canvas_width/2.03, canvas_height/2.03, 5 * scale);
    letter_p.attr({fill: 'none', stroke: 'grey', 'stroke-width': 7 * scale});
  }

  paper_content.toBack();
  paper_shadow.toBack();
  paper.setSize(size, size);

  return $(element).find('svg');
}

// Returns the coordinates in the right order for a word.
function getCoordinatesFromWord(word) {
  var coordinates = new Array(word.length);

  for(var i = 0; i < coordinates.length; i++) {
    coordinates[i] = letter2coord(word[i]);
  }

  return coordinates;
}

// Creates a colored word.
function drawColoredWord(word) {
  var output = '';

  for(var i = 0; i < word.length; i++){
    var letter = word[i].toLowerCase();
    var color = getColorForLetter(letter);
    var style_class = '';

    if(word[i] >= 0 && word[i] < 10){
      color = colors[word[i]];
    }

    switch(letter) {
      case 'k':
        style_class = 'silver-letter';
        break;
      case 'l':
        style_class = 'silver-letter';
        break;
      case 'r':
        style_class = 'silver-letter';
        break;
      case 's':
        style_class = 'silver-letter';
        break;
      case 'v':
        style_class = 'silver-letter';
        break;
      case 'ä':
        style_class = 'umlaut-letter';
        break;
      case 'ö':
        style_class = 'umlaut-letter';
        break;
      case 'ü':
        style_class = 'umlaut-letter';
        break;
      case 'p':
        style_class = 'p-letter';
        break;
    }

    output += '<span class="' + style_class + '" style="background-color:' + color + ';border:2px solid ' + color + ';">' + word[i] + '</span>';
  }

  return output;
}

// Returns the color for a letter.
function getColorForLetter(letter) {

  switch(letter) {
    case 'ä':
      letter = 'a';
      break;
    case 'ö':
      letter = 'o';
      break;
    case 'ü':
      letter = 'u';
      break;
  }

  for(var i = 0; i < letters.length; i++){
    for(var j = 0; j < letters[i].length; j++){
      if($.inArray(letter, letters[i][j]) > -1){
        return coord2color(i, j);
      }
    }
  }

  return 'none';
}

// Checks if word has a P.
function hasALetterP(word) {
  if(word.toLowerCase().indexOf('p') != -1) {
    return true
  }else{
    return false;
  }
}

function blockColor(word, letter, color) {
  var block_color = 'none';

  if(letter == null) {
    return block_color;
  }

  if(letter.constructor == (new Array).constructor){
    for(var i = 0;i<letter.length;i++){
      if(word.indexOf(letter[i]) > -1){
        block_color = color;
      }
    }
  }else{
    if(word.indexOf(letter) > -1){
      block_color = color;
    }
  }
  return block_color;
}

function pointColor(color) {
  if(color == 'none'){
    return 'gray';
  }
  return 'white';
}

function pointWidth(color) {
  if(color == 'none'){
    return 1;
  }
  return 2;
}

function letter2coord(letter) {
  var coor = new Array(2);

  for(var x = 0; x < letters.length; x++){
    for(var y = 0; y < letters[x].length; y++) {
      if(letters[x][y].indexOf(letter.toLowerCase()) > -1){
        coor[0] = y;
        coor[1] = x;
      }
    }
  }

  return coor;
}

function coord2index(x, y) {
  return 4 * y + (3 - x);
}

function digit(index) {
  return Math.floor(Math.pow(10, index + 1) /17) % 10;
}

function coord2digit(x, y) {
  return digit(coord2index(x, y));
}

// Color for a coordinate.
function coord2color(x, y) {
  return colors[coord2digit(x, y)];
}
